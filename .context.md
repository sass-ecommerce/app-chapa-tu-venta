# Contexto del Proyecto: Chapa Tu Venta

## Descripción General

**Chapa Tu Venta** es una aplicación móvil React Native construida con Expo para gestión de ventas y productos de tiendas. La aplicación permite a los propietarios de tiendas registrar sus negocios, agregar productos al inventario, visualizar ventas recientes y gestionar su perfil.

## Stack Tecnológico

### Core

- **React Native**: 0.81.5
- **React**: 19.1.0
- **Expo**: ~54.0.29
- **TypeScript**: ~5.9.2

### Navegación y Routing

- **Expo Router**: ~6.0.19 (File-based routing)
- **React Navigation**: ^7.0.0

### Autenticación

- **Clerk**: ^2.16.1 (Autenticación con email, teléfono, username y SSO)
- **expo-auth-session**: ~7.0.10
- **expo-secure-store**: ~15.0.8

### Gestión de Estado

- **Zustand**: ^5.0.10 (State management)
- **TanStack React Query**: ^5.90.20 (Data fetching y caching)

### UI y Estilos

- **NativeWind**: ^4.2.1 (Tailwind CSS para React Native)
- **Tailwind CSS**: ^3.4.14
- **tailwindcss-animate**: ^1.0.7
- **React Native Reusables**: UI primitives (@rn-primitives/\*)
- **Lucide React Native**: ^0.545.0 (Iconos)
- **expo-linear-gradient**: ~15.0.8

### Formularios y Validación

- **TanStack React Form**: ^1.27.7
- **Zod**: ^4.3.5 (Schema validation)

### Backend/API

- **Supabase**: Base de datos PostgreSQL y API REST
- Configuración en `lib/api/config.ts`

### Otros

- **expo-image-picker**: ~17.0.10
- **react-native-svg**: ^15.12.1
- **react-native-circular-progress**: ^1.4.1

## Estructura del Proyecto

```
app-chapa-tu-venta/
├── app/                          # Rutas de la aplicación (Expo Router)
│   ├── (auth)/                   # Grupo de rutas de autenticación
│   │   ├── sign-in.tsx          # Inicio de sesión
│   │   ├── sign-up/             # Registro de usuario
│   │   │   ├── index.tsx
│   │   │   ├── verify-email.tsx
│   │   │   └── _layout.tsx
│   │   ├── forgot-password.tsx   # Recuperar contraseña
│   │   └── reset-password.tsx    # Resetear contraseña
│   ├── (onboarding)/             # Flujo de onboarding
│   │   ├── owner-info.tsx       # Información del propietario
│   │   └── register-store.tsx   # Registro de tienda
│   ├── (tabs)/                   # Navegación por tabs
│   │   ├── index.tsx            # Home/Dashboard
│   │   ├── products.tsx         # Lista de productos
│   │   ├── profile.tsx          # Perfil de usuario
│   │   └── _layout.tsx
│   ├── products/                 # Rutas de productos
│   │   ├── [id].tsx             # Detalle de producto (ruta dinámica)
│   │   └── create.tsx           # Crear producto
│   ├── profile/                  # Rutas de perfil
│   │   └── edit.tsx             # Editar perfil
│   ├── _layout.tsx              # Layout principal con providers
│   ├── +not-found.tsx           # Página 404
│   └── +html.tsx                # HTML template
├── components/                   # Componentes reutilizables
│   ├── ui/                      # Componentes UI primitivos
│   ├── product-card.tsx         # Tarjeta de producto
│   ├── edit-profile-form.tsx    # Formulario de edición
│   ├── sign-in-form.tsx         # Formulario de login
│   └── reset-password-form.tsx
├── lib/                         # Utilidades y configuración
│   ├── api/                     # Configuración de API
│   │   ├── config.ts           # Config de Supabase
│   │   ├── products.ts         # API de productos
│   │   ├── stores.ts           # API de tiendas
│   │   └── users.ts            # API de usuarios
│   ├── hooks/                   # Custom hooks
│   ├── store/                   # Zustand stores
│   │   └── products-store.ts
│   ├── constants.ts             # Constantes globales
│   ├── theme.ts                 # Configuración de tema
│   └── utils.ts                 # Funciones utilitarias
├── assets/                      # Recursos estáticos
│   └── images/
└── global.css                   # Estilos globales de Tailwind
```

## Rutas Protegidas

### Autenticación Requerida

- `(tabs)/*` - Todas las tabs (Home, Productos, Perfil)
- `(onboarding)/*` - Flujo de onboarding
- `products/[id]` - Detalle de producto
- `products/create` - Crear producto
- `profile/edit` - Editar perfil

### Rutas Públicas

- `(auth)/*` - Login, registro, recuperación de contraseña
- `+not-found` - Página 404

## Flujo de Autenticación

1. Usuario llega a la app
2. Si no está autenticado → Redirige a `/sign-in`
3. Usuario puede:
   - Iniciar sesión con email/password
   - Usar OAuth (Apple, Google, GitHub)
   - Registrarse en `/sign-up`
4. Después del login exitoso:
   - Si es primera vez → Onboarding (`owner-info` → `register-store`)
   - Si ya completó onboarding → Dashboard (`(tabs)/index`)

## Flujo de Onboarding

1. **Owner Info** (`/onboarding/owner-info`):
   - Nombre completo
   - Número de teléfono
   - Se guarda en `user.unsafeMetadata.lastStep`

2. **Register Store** (`/onboarding/register-store`):
   - Nombre de la tienda
   - Dirección
   - RUC (11 dígitos, debe empezar con 10 o 20)
   - Categoría de productos
   - Botón de cerrar sesión disponible
   - Crea tienda en Supabase
   - Actualiza user metadata con store_id
   - Redirige a Dashboard

## Modelos de Datos

### Product (Producto)

```typescript
interface Product {
  id: string;
  store_id?: number;
  category_id?: string;
  sku?: string;
  name: string;
  description?: string;
  price: number;
  price_list?: number;
  price_base?: number;
  stock_quantity: number;
  image_uri?: string;
  rating?: number;
  trending?: boolean;
  is_active?: boolean;
  created_at?: string;
}
```

### Store (Tienda)

```typescript
interface Store {
  id: number;
  name: string;
  slug: string;
  owner_email: string | null;
  plan: string | null;
  settings: any | null;
  created_at: string;
  status: boolean;
  updated_at: string | null;
  ruc: number | null;
}
```

### User (Usuario)

```typescript
interface User {
  id: number;
  slug: string;
  name: string;
  email: string;
  store_id?: number | null;
  created_at: string;
  updated_at: string | null;
}
```

## Características Principales

### Dashboard (Home)

- Saludo personalizado con nombre del usuario
- Saldo actual en soles (S/)
- Tarjetas de "Últimos Productos Agregados" (scroll horizontal)
  - Muestra: nombre, precio, stock
  - Iconos distintivos por producto
  - Colores: morado (#7c3aed) y blanco con borde
- Lista de "Últimas Ventas"
  - Muestra: nombre producto, fecha, monto en verde
  - Iconos de ShoppingBag y Package
  - Montos en soles (S/)
- Pull to refresh

### Productos

- Lista de productos del inventario
- Crear nuevos productos
- Ver detalles de productos
- Editar productos

### Perfil

- Ver información del usuario
- Editar perfil
- Cerrar sesión

## Variables de Entorno

Archivo `.env.local`:

```
EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY=
EXPO_PUBLIC_SUPABASE_URL=
EXPO_PUBLIC_SUPABASE_API_KEY=
EXPO_PUBLIC_SUPABASE_AUTH_TOKEN=
```

## Configuración de Clerk

- Email, phone, username habilitados
- SSO: Apple, GitHub, Google
- Token cache usando expo-secure-store

## Temas y Estilos

- Soporte para modo claro y oscuro
- Colores principales:
  - Primary: `#7c3aed` (morado)
  - Active tab: `#9333ea` (dark) / `#7c3aed` (light)
  - Success/Sales: `#10b981` (verde)
- Uso de NativeWind para clases de Tailwind
- Componentes UI de React Native Reusables

## Idioma

- La aplicación está en **español**
- Divisa: Soles peruanos (S/)
- Formato de RUC peruano (11 dígitos)

## Scripts Disponibles

```bash
npm run dev        # Iniciar servidor de desarrollo
npm run ios        # Correr en iOS
npm run android    # Correr en Android
npm run web        # Correr en web
npm run clean      # Limpiar cache y node_modules
```

## Categorías de Productos

- Ropa y Accesorios
- Perfumes y Fragancias
- Tecnología
- Alimentos y Bebidas
- Salud y Belleza
- Hogar y Decoración
- Deportes y Fitness
- Juguetes y Juegos
- Libros y Papelería
- Otros

## Constantes Importantes

```typescript
// lib/constants.ts
export const ONBOARDING_STEPS = {
  OWNER_INFO: 'owner-info',
  REGISTER_STORE: 'register-store',
};
```

## Notas Técnicas

- Nueva arquitectura de React Native habilitada
- Edge to Edge habilitado
- Safe Area Context configurado
- LogBox configurado para ignorar warnings de deprecación de SafeAreaView
- Query client configurado con staleTime de 5 minutos
- 2 reintentos por defecto en queries

## Próximas Mejoras Potenciales

- Integración de pagos
- Reportes de ventas
- Gestión de inventario avanzada
- Notificaciones push
- Multi-tienda
- Dashboard con métricas y gráficos
- Escaneo de códigos de barras
- Exportación de datos
